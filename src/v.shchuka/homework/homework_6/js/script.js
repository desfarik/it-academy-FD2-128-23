const ALBUMS = [
  {
    id: 1,
    name: "Dance",
    img: "./images/cover album Dance.jpg",
    songs: [
      {
        id: 1,
        author: "Katy Perry",
        name: "Roar",
        duration: `${3}:${42}`,
        img: "./images/cover Katy Perry - Roar.jpg",
        src: "./music/Katy Perry - Roar.mp3",
      },
      {
        id: 2,
        author: "Taylor Swift",
        name: "RShake It Off",
        duration: `${3}:${39}`,
        img: "./images/cover Taylor Swift - Shake It Off.jpg",
        src: "./music/Taylor Swift - Shake It Off.mp3",
      },
      {
        id: 3,
        author: "Marshmello & Anne-Marie",
        name: "FRIENDS",
        duration: `${3}:${29}`,
        img: "./images/cover Marshmello & Anne-Marie - FRIENDS.jpg",
        src: "./music/Marshmello & Anne-Marie - FRIENDS.mp3",
      },
      {
        id: 4,
        author: "Justin Bieber",
        name: "Baby",
        duration: `${3}:${31}`,
        img: "./images/cover Justin Bieber - Baby.jpg",
        src: "./music/Justin Bieber - Baby.mp3",
      },
      {
        id: 5,
        author: "Alan Walker",
        name: "Faded",
        duration: `${3}:${32}`,
        img: "./images/cover Alan Walker - Faded.jpg",
        src: "./music/Alan Walker - Faded.mp3",
      },
    ],
  },
  {
    id: 2,
    name: "Top",
    img: "./images/cover album Top.jpg",
    songs: [
      {
        id: 1,
        author: "SZA",
        name: "Kill Bill",
        duration: `${2}:${33}`,
        img: "./images/cover SZA - Kill Bill.jpg",
        src: "./music/SZA - Kill Bill.mp3",
      },
      {
        id: 2,
        author: "Miley Cyrus",
        name: "Flowers",
        duration: `${3}:${20}`,
        img: "./images/cover Miley Cyrus - Flowers.jpg",
        src: "./music/Miley Cyrus - Flowers.mp3",
      },
      {
        id: 3,
        author: "Rosala",
        name: "BESO",
        duration: `${3}:${14}`,
        img: "./images/cover Rosala - BESO.jpg",
        src: "./music/Rosala - BESO.mp3",
      },
      {
        id: 4,
        author: "Ed Sheeran",
        name: "Eyes Closed",
        duration: `${4}:${37}`,
        img: "./images/cover Ed Sheeran - Eyes Closed.jpg",
        src: "./music/Ed Sheeran - Eyes Closed.mp3",
      },
      {
        id: 5,
        author: "Harry Styles",
        name: "As It Was",
        duration: `${2}:${47}`,
        img: "./images/cover Harry Styles - As It Was.jpg",
        src: "./music/Harry Styles - As It Was.mp3",
      },
    ],
  },
  {
    id: 3,
    name: "Rock",
    img: "./images/cover album Rock.jpg",
    songs: [
      {
        id: 1,
        author: "KINO",
        name: "Кукушка",
        duration: `${6}:${34}`,
        img: "./images/cover KINO - Кукушка.jpg",
        src: "./music/KINO - Кукушка.mp3",
      },
      {
        id: 2,
        author: "Би2",
        name: "Полковник",
        duration: `${4}:${56}`,
        img: "./images/cover Би2 - Полковник.jpg",
        src: "./music/Би2 - Полковник.mp3",
      },
      {
        id: 3,
        author: "7Б",
        name: "Жди",
        duration: `${4}:${15}`,
        img: "./images/cover 7Б - Жди.jpg",
        src: "./music/7Б - Жди.mp3",
      },
      {
        id: 4,
        author: "Ария",
        name: "Беспечный Ангел",
        duration: `${3}:${54}`,
        img: "./images/cover Ария - Беспечный Ангел.jpg",
        src: "./music/Ария - Беспечный Ангел.mp3",
      },
      {
        id: 5,
        author: "Lyapis Trubeckoj",
        name: "Rabkor",
        duration: `${3}:${39}`,
        img: "./images/cover Lyapis Trubeckoj - Rabkor.jpg",
        src: "./music/Lyapis Trubeckoj - Rabkor.mp3",
      },
    ],
  },
  {
    id: 4,
    name: "Michael Jackson",
    img: "./images/cover album Michael Jackson.jpg",
    songs: [
      {
        id: 1,
        author: "Michael Jackson",
        name: "Billie Jean",
        duration: `${4}:${53}`,
        img: "./images/cover Michael Jackson - Billie Jean.jpg",
        src: "./music/Michael Jackson - Billie Jean.mp3",
      },
      {
        id: 2,
        author: "Michael Jackson",
        name: "They Don't Care About Us",
        duration: `${4}:${44}`,
        img: "./images/cover Michael Jackson - They Don't Care About Us.jpg",
        src: "./music/Michael Jackson - They Don't Care About Us.mp3",
      },
      {
        id: 3,
        author: "Michael Jackson",
        name: "Black Or White",
        duration: `${3}:${19}`,
        img: "./images/cover Michael Jackson - Black Or White.jpg",
        src: "./music/Michael Jackson - Black Or White.mp3",
      },
      {
        id: 4,
        author: "Michael Jackson",
        name: "You Are Not Alone",
        duration: `${4}:${34}`,
        img: "./images/cover Michael Jackson - You Are Not Alone.jpg",
        src: "./music/Michael Jackson - You Are Not Alone.mp3",
      },
      {
        id: 5,
        author: "Michael Jackson",
        name: "Smooth Criminal",
        duration: `${4}:${16}`,
        img: "./images/cover Michael Jackson - Smooth Criminal.jpg",
        src: "./music/Michael Jackson - Smooth Criminal.mp3",
      },
    ],
  },
  {
    id: 5,
    name: "Trance",
    img: "./images/cover album Trance.jpg",
    songs: [
      {
        id: 1,
        author: "Alchemorph",
        name: "The Race",
        duration: `${4}:${11}`,
        img: "./images/cover Alchemorph - The Race.jpg",
        src: "./music/Alchemorph - The Race.mp3",
      },
      {
        id: 2,
        author: "Aurora Night",
        name: "Fill",
        duration: `${2}:${37}`,
        img: "./images/cover Aurora Night - Fill.jpg",
        src: "./music/Aurora Night - Fill.mp3",
      },
      {
        id: 3,
        author: "Uppermost",
        name: "Overnight",
        duration: `${5}:${10}`,
        img: "./images/cover Uppermost - Overnight.jpg",
        src: "./music/Uppermost - Overnight.mp3",
      },
      {
        id: 4,
        author: "The Ambientalist",
        name: "Coming Home",
        duration: `${4}:${10}`,
        img: "./images/cover The Ambientalist - Coming Home.jpg",
        src: "./music/The Ambientalist - Coming Home.mp3",
      },
      {
        id: 5,
        author: "Beatsole",
        name: "Electric Dreams",
        duration: `${6}:${59}`,
        img: "./images/cover Beatsole - Electric Dreams.jpg",
        src: "./music/Beatsole - Electric Dreams.mp3",
      },
    ],
  },
];

const elementCovers = document.querySelector(".covers");
const elementListSongs = document.querySelector(".list-songs");
const elementPlayerCover = document.querySelector(".player__cover");
const elementSearch = document.querySelector(".search");
const elementSearchInput = document.querySelector(".search-input");
const audio = document.querySelector(".audio");
const elementButtonPause = document.querySelector(".button-pause");
let globalSongId = 0;
let counter = 0;

generateAlbums(ALBUMS);
showSongsAlbum(1);
showCurrentSong(1, 1);

function generateAlbums(albums) {
  const html = albums
    .map(
      (album) =>
        `
    <img
    data-id="${album.id}"
    class="img-cover"
    src="${album.img}"
    alt="cover ${album.name}"
    onclick ="showSongsAlbum(${album.id})"
    />`
    )
    .join("");
  elementCovers.innerHTML = html;
}
function findAlbum(albumId) {
  return ALBUMS.find((album) => album.id === albumId);
}

function showSongsAlbum(albumId) {
  showActiveAlbum(albumId);
  const album = findAlbum(albumId);
  const songs = album.songs;
  generateSongs(songs, album);
  addEventInput(album);
}

function addEventInput(album) {
  elementSearchInput.value = "";
  elementSearchInput.setAttribute("oninput", `searchSongs(${album.id})`);
}

function generateSongs(songs, album) {
  const html = songs
    .map(
      (song) => `<div class="song">
<div class="cover">
  <img
    class="img-cover"
    src="${song.img}"
    alt="cover ${song.author} - ${song.name}"
  />
  <div class="song-text song-text--width">${song.author} - ${song.name}</div>
</div>
<div class="play-container">
  <div class="song-text">${song.duration}</div>
  <button data-id="${song.id}" class="button item-button-play" type="button" onclick ="showCurrentSong(${album.id}, ${song.id})">
    <img
      class="item-play-icon"
      src="./images/play_button.svg"
      alt="play icon"
    />
  </button>

</div>
</div>`
    )
    .join("");
  elementListSongs.innerHTML = html;
}

function findSong(albumId, songId) {
  const album = findAlbum(albumId);
  return album.songs.find((song) => song.id === songId);
}
function showCurrentSong(albumId, songId) {
  const elementButtonPlayBack = document.querySelector(".button-play-back");
  const elementButtonPlayNext = document.querySelector(".button-play-next");
  const song = findSong(albumId, songId);
  const currentSongId = +`${albumId}${song.id}`;
  const html = `
  <img
  class="img-cover player__img"
  src="${song.img}"
  alt="cover ${song.author} - ${song.name}"
/>
<div class="song-info">
  <div class="author">${song.name}</div>
  <div class="song-text">${song.author}</div>
</div>`;
  if (globalSongId !== currentSongId) {
    elementPlayerCover.innerHTML = html;
    elementButtonPlayBack.setAttribute(
      "onclick",
      `getNextSong(${albumId}, ${song.id}, "back")`
    );
    elementButtonPause.setAttribute(
      "onclick",
      `playSong(${albumId}, ${song.id})`
    );
    elementButtonPlayNext.setAttribute(
      "onclick",
      `getNextSong(${albumId}, ${song.id}, "next")`
    );
    audio.setAttribute("src", `${song.src}`);
    globalSongId = currentSongId;
  } else if (currentSongId === 11) {
    globalSongId = 11;
  } else {
    globalSongId = 0;
  }
  if (counter !== 0) {
    playSong(albumId, songId);
  }
  counter++;
}

function showActiveAlbum(albumId) {
  const selectedElementCover = document.querySelector(
    `img[data-id='${albumId}']`
  );
  const allElementCover = document.querySelectorAll(".img-cover");
  allElementCover.forEach((element) => {
    if (element.classList.contains("active")) {
      element.classList.remove("active");
    }
  });
  selectedElementCover.classList.add("active");
}

function playSong(albumId, songId) {
  showButtonPause(albumId, songId);
  if (audio.paused) {
    audio.play();
  } else {
    audio.pause();
  }
}

function getNextSong(albumId, songId, index) {
  const album = findAlbum(albumId);
  let newSongId = songId;
  for (let i = 0; i < album.songs.length; i++) {
    const song = album.songs[i];
    if (album.songs.at(-1).id === newSongId && index === "next") {
      newSongId = album.songs[0].id;
      break;
    } else if (album.songs[0].id === newSongId && index === "back") {
      newSongId = album.songs.at(-1).id;
      break;
    } else if (song.id === newSongId && index === "next") {
      const songNext = album.songs[i + 1];
      newSongId = songNext.id;
      break;
    } else if (song.id === newSongId && index === "back") {
      const songNext = album.songs[i - 1];
      newSongId = songNext.id;
      break;
    }
  }
  showCurrentSong(albumId, newSongId);
}

function searchSongs(albumId) {
  const searchSong = document.querySelector(".search-input");
  const phrase = searchSong.value.toLowerCase();
  const album = findAlbum(albumId);
  const songs = album.songs.filter((song) => {
    return (
      song.author.toLowerCase().includes(phrase) ||
      song.name.toLowerCase().includes(phrase)
    );
  });
  generateSongs(songs, album);
}

function formEvent(event) {
  event.preventDefault();
}

function showButtonPause(albumId, songId) {
  const elementActive = document.querySelector(".active");
  const currentAlbumId = +elementActive.getAttribute("data-id");
  const elementItemButton = document.querySelector(
    `button[data-id='${songId}']`
  );
  const allElementsItemButtonPlay =
    document.querySelectorAll(".item-button-play");
  const htmlIconPause =
    '<img class="icon-pause" src="./images/pause.svg" alt="icon pause" />';
  const htmlIconPLay =
    '<span class="material-symbols-outlined icon-play">play_arrow</span>';
  const htmlItemPause =
    '<span class="material-symbols-outlined item-pause-icon">pause_circle</span>';
  const htmlItemPlay =
    '<img class="item-play-icon" src="./images/play_button.svg" alt="play icon" />';
  if (currentAlbumId === albumId) {
    elementButtonPause.innerHTML = audio.paused ? htmlIconPause : htmlIconPLay;
    elementItemButton.innerHTML = audio.paused ? htmlItemPause : htmlItemPlay;
  } else {
    elementButtonPause.innerHTML = audio.paused ? htmlIconPause : htmlIconPLay;
  }
  allElementsItemButtonPlay.forEach((element) => {
    const currentSongId = +element.getAttribute("data-id");
    if (songId !== currentSongId) {
      element.innerHTML = htmlItemPlay;
    }
  });
}
